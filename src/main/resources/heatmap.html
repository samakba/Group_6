<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Heatmap</title>
  <style> 
    html, body, #map { height: 100%; margin: 0; padding: 0 }
    #map { background-color: #e0e0e0; } /* Added a background color */
    #debug { position: absolute; top: 10px; left: 10px; z-index: 1000; background: white; padding: 10px; border: 1px solid black; }
  </style>
</head>
<body>
  <div id="debug">Loading...</div>
  <div id="map"></div>
  
  <script>
    document.getElementById('debug').innerHTML = 'JavaScript loaded';
    
    let map, heatmap;
    
    function initMap() {
      try {
        document.getElementById('debug').innerHTML = 'Creating map...';
        
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 43.6532, lng: -79.3832},
          zoom: 13,
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          disableDefaultUI: false,
          zoomControl: true,
          mapTypeControl: true,
          streetViewControl: false,
          visible: true,
        });
        
        google.maps.event.addListenerOnce(map, 'tilesloaded', function() {
          document.getElementById('debug').innerHTML = 'Map tiles loaded, creating heatmap...';
          
          heatmap = new google.maps.visualization.HeatmapLayer({
            data: [],
            map: map,
            radius: 50,
            opacity: 0.6
          });
          
          document.getElementById('debug').innerHTML = 'Heatmap layer created! Waiting for data from Java...';
        });
        
      } catch (error) {
        document.getElementById('debug').innerHTML = 'Error: ' + error.message;
        console.error('Map initialization error:', error);
      }
    }
    
    function updateHeatmap(pointsJson) {
      try {
        if (!heatmap) {
          document.getElementById('debug').innerHTML = 'Heatmap not ready yet';
          return;
        }

        const points = JSON.parse(pointsJson);
        
        document.getElementById('debug').innerHTML = 'Updating with ' + points.length + ' points';
        const gmPoints = points.map(p => ({
          location: new google.maps.LatLng(p.lat, p.lng),
          weight: p.weight || 0.5
        }));
        heatmap.setData(gmPoints);
        document.getElementById('debug').innerHTML = 'Updated successfully with ' + points.length + ' points';
      } catch (error) {
        document.getElementById('debug').innerHTML = 'Update error: ' + error.message;
        console.error('Update error:', error);
      }
    }
    
    function gm_authFailure() {
      document.getElementById('debug').innerHTML = 'Google Maps API authentication failed. Check your API key and billing status in the Google Cloud Console.';
    }
    
    window.initMap = initMap;
    window.gm_authFailure = gm_authFailure;
    
    document.getElementById('debug').innerHTML = 'Loading Google Maps API...';
  </script>
  
IMPORTANT: Replace YOUR_API_KEY_HERE with the new key you just created
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC8I7L3-oAlAcrdTuxa_ymhwMcLoVVsyt4&libraries=visualization&callback=initMap" defer></script>
</body>
</html>

